# Echo Â· å¹¿åœºåŠŸèƒ½è®¾è®¡

**æ—¥æœŸ**: 2026-01-28  
**ç‰ˆæœ¬**: 1.0  
**ä¼˜å…ˆçº§**: P2ï¼ˆè¿è¥æ‰©å±•ï¼‰

---

## ğŸ¯ æ ¸å¿ƒå®šä½

### ä¸‰å±‚æ¶æ„

```
å¹¿åœº (Square)     = å…¬å…±è¡¨è¾¾å±‚ (Public Broadcast)
ç¾¤/é¢‘é“ (Spaces)  = ä¸»é¢˜ç©ºé—´ (Themed Spaces)
ç§èŠ (IM)         = ç§å¯†å…³ç³» (Private Messaging)
```

### æ ¸å¿ƒåŸåˆ™

1. **å…¬å¼€ä¸ç§å¯†ä¸å†²çª** - å…¬å¼€å†…å®¹å¿…é¡»æ˜¯"ç”¨æˆ·ä¸»åŠ¨å…¬å¼€"
2. **ç¾¤å†…å®¹é»˜è®¤ä¸å…¬å¼€** - éœ€è¦ç¾¤ä¸»/é¢‘é“ä¸»ä¸»åŠ¨å¼€å¯åŒæ­¥
3. **è¯„è®ºæ˜¯"å›åº”è¡¨è¾¾"ï¼Œä¸æ˜¯"äº‰å¤ºè¯è¯­æƒ"** - å•å±‚è¯„è®ºï¼Œæ— ç›–æ¥¼ï¼Œæ— çƒ­è¯„
4. **ä¸åšæ›å…‰ç«æŠ€åœº** - ä¸ä»¥ç²‰ä¸æ•°ä½œä¸ºä¸»è¦åˆ†å‘é€»è¾‘
5. **æ²‰æ·€ä¼˜å…ˆ** - æ ¸å¿ƒ KPI æ˜¯æ”¶è—ç‡ã€è½¬å‘ç‡ã€å›æµç‡ï¼Œè€Œéç‚¹èµæ•°

---

## ğŸ“Š åŠŸèƒ½ä¼˜å…ˆçº§æ€»è§ˆ

### ğŸŸ¥ P0 - æœ€å°å¯ç”¨ç‰ˆæœ¬ï¼ˆæ²¡æœ‰è¿™äº›å°±ä¸æˆç«‹ï¼‰

| # | æ¨¡å— | åŠŸèƒ½ | è¯´æ˜ |
|---|------|------|------|
| 1 | å‘å¸ƒ | ä¸ªäººå¹¿æ’­ | ç›´æ¥å‘å¸ƒåˆ°å¹¿åœº |
| 2 | å‘å¸ƒ | ç¾¤/é¢‘é“åŒæ­¥ | å¯é€‰åŒæ­¥åˆ°å¹¿åœº |
| 3 | ä¿¡æ¯æµ | æ¨èæµ | é»˜è®¤ä¿¡æ¯æµ |
| 4 | ä¿¡æ¯æµ | æœ€æ–°æµ | çº¯æ—¶é—´çº¿ |
| 5 | äº’åŠ¨ | ç‚¹èµ/æ”¶è—/è½¬å‘ | åŸºç¡€äº’åŠ¨ |
| 6 | äº’åŠ¨ | ä¸¾æŠ¥ | æ²»ç†åº•åº§ |
| 7 | æ¥æºæ ‡è¯† | Context Tag | æ¸…æ™°æ˜¾ç¤ºæ¥æº |
| 8 | æ²»ç† | æ‹‰é»‘/å±è”½ | ç”¨æˆ·ä¾§æ§åˆ¶ |

### ğŸŸ§ P1 - ä½“éªŒå¢å¼ºï¼ˆå¼€å§‹"å¥½ç”¨ã€è€ç”¨"ï¼‰

| # | æ¨¡å— | åŠŸèƒ½ | è¯´æ˜ |
|---|------|------|------|
| 9 | å†…å®¹æ§åˆ¶ | ä¸æ„Ÿå…´è¶£ | é™ä½ç›¸ä¼¼å†…å®¹ |
| 10 | æµè§ˆå‘ç° | æœ€æ–°/çƒ­é—¨åˆ‡æ¢ | å¼±ç®—æ³• |
| 11 | äº’åŠ¨ | è½»è¯„è®º | å•å±‚è¯„è®ºï¼Œæ— ç›–æ¥¼ |
| 12 | å›æµ | å¹¿åœºâ†”ç¾¤ | å»ç¾¤é‡Œè®¨è®º |
| 13 | ä¸ªäººé¡µ | å…¬å¼€å†…å®¹å±•ç¤º | å…‹åˆ¶ä½†å¯ç”¨ |

### ğŸŸ¨ P2 - è§„æ¨¡åå†åŠ 

| # | æ¨¡å— | åŠŸèƒ½ | è¯´æ˜ |
|---|------|------|------|
| 14 | æ¨è | å¤šè¯­è¨€/åœ°åŒºåŒ– | æœ¬åœ°åŒ–æ¨è |
| 15 | åˆ›ä½œè€…å·¥å…· | æ•°æ®é¢æ¿ | æ›å…‰ã€äº’åŠ¨ç»Ÿè®¡ |
| 16 | é«˜çº§æ²»ç† | ä¿¡èª‰åˆ†/ååˆ· | é˜²åˆ·èµ/æ¬è¿ |
| 17 | é«˜çº§å‘ç° | ç›¸ä¼¼æ¨è | å†·å¯åŠ¨æ¢ç´¢ |

---

## ğŸŸ¥ P0 åŠŸèƒ½è¯¦ç»†è®¾è®¡

### 1ï¸âƒ£ å‘å¸ƒ - ä¸¤ç§å¹¶åˆ—è·¯å¾„

#### A. ä¸ªäººå¹¿æ’­ï¼ˆé»˜è®¤ï¼‰

**å‘å¸ƒå…¥å£**:
```typescript
interface PersonalBroadcast {
  // å†…å®¹
  contentType: 'text' | 'image' | 'video' | 'mixed';
  text?: string;                // æœ€å¤š 5000 å­—
  images?: string[];            // æœ€å¤š 9 å¼ 
  video?: string;               // å•ä¸ªè§†é¢‘
  
  // è‰ç¨¿
  isDraft: boolean;
  draftId?: string;
  
  // æ¥æºæ ‡è¯†
  source: 'personal';           // å›ºå®šä¸º personal
}
```

**æ“ä½œåŠŸèƒ½**:
- å‘å¸ƒåˆ°å¹¿åœº
- ä¿å­˜è‰ç¨¿
- åˆ é™¤è‡ªå·±çš„å†…å®¹
- è½»ç¼–è¾‘ï¼ˆé™æ—¶ä¿®é”™å­—ï¼Œä¿ç•™ç¼–è¾‘æ ‡è®°ï¼‰

**é™åˆ¶**:
- æ–°ç”¨æˆ·å†·å´æœŸï¼ˆ24å°æ—¶å†…ä¸èƒ½å‘å¸ƒï¼‰
- é¢‘ç‡é™åˆ¶ï¼ˆæ¯å°æ—¶æœ€å¤š 5 æ¡ï¼‰
- å†…å®¹å®¡æ ¸ï¼ˆæ•æ„Ÿè¯è¿‡æ»¤ï¼‰


#### B. ç¾¤/é¢‘é“åŒæ­¥ï¼ˆå¯é€‰æ¥æºï¼‰

**å‰ææ¡ä»¶**:
- ç¾¤/é¢‘é“å¼€å¯ã€Œå…è®¸åŒæ­¥åˆ°å¹¿åœºã€
- ç”¨æˆ·åœ¨å‘å¸ƒæ—¶ä¸»åŠ¨å‹¾é€‰ã€ŒåŒæ­¥åˆ°å¹¿åœºã€

**åŒæ­¥å†…å®¹**:
```typescript
interface ChatSyncContent {
  // æ¥æºä¿¡æ¯
  source: 'chat' | 'channel';
  sourceChatId: string;
  sourceChatTitle: string;
  sourceChatUsername?: string;
  
  // å†…å®¹ï¼ˆä¸ä¸ªäººå¹¿æ’­ç›¸åŒï¼‰
  contentType: 'text' | 'image' | 'video' | 'mixed';
  text?: string;
  images?: string[];
  video?: string;
  
  // åŒæ­¥è®¾ç½®
  syncToSquare: boolean;        // ç”¨æˆ·ä¸»åŠ¨å‹¾é€‰
  showSourceLink: boolean;      // æ˜¾ç¤ºæ¥æºé“¾æ¥
}
```

**æ¥æºæ ‡è¯†**:
- æ¸…æ™°æ˜¾ç¤ºã€Œæ¥è‡ª Ã—Ã— ç¾¤/é¢‘é“ã€
- ç‚¹å‡»æ¥æºå¯è¿›å…¥ç¾¤/é¢‘é“è¯´æ˜é¡µ
- å±•ç¤ºã€Œå»ç¾¤é‡Œè®¨è®º / åŠ å…¥ / è®¢é˜…ã€å…¥å£

**é™åˆ¶**:
- åªæœ‰ç¾¤ä¸»/ç®¡ç†å‘˜å¯ä»¥å¼€å¯åŒæ­¥
- åŒæ­¥å†…å®¹ä¸å±•ç¤ºç¾¤å†…è¿ç»­èŠå¤©ä¸Šä¸‹æ–‡
- åªå±•ç¤ºå•æ¡å†…å®¹ï¼ˆæ‘˜è¦å½¢å¼ï¼‰

---

### 2ï¸âƒ£ å¹¿åœºä¿¡æ¯æµ (Feed)

#### æ¨èæµï¼ˆé»˜è®¤ï¼‰

**ç®—æ³•é€»è¾‘**:
```typescript
interface RecommendationFeed {
  // å€™é€‰æº
  candidates: {
    inNetwork: Post[];          // å·²åŠ å…¥çš„ç¾¤/é¢‘é“å†…å®¹
    outNetwork: Post[];         // å…¨ç«™æ¢ç´¢å†…å®¹
  };
  
  // è¿‡æ»¤è§„åˆ™
  filters: {
    blacklist: string[];        // é»‘åå•ç”¨æˆ·/æ¥æº
    riskControl: boolean;       // é£æ§è¿‡æ»¤
    deduplication: boolean;     // å»é‡
    timeDecay: boolean;         // æ—¶é—´è¡°å‡
  };
  
  // è¯„åˆ†å› å­
  scoringFactors: {
    recency: number;            // æ—¶æ•ˆæ€§
    likes: number;              // ç‚¹èµæ•°
    reposts: number;            // è½¬å‘æ•°
    saves: number;              // æ”¶è—æ•°ï¼ˆé«˜æƒé‡ï¼‰
    dwell: number;              // åœç•™æ—¶é•¿
    joinClicks: number;         // å…¥ç¾¤ç‚¹å‡»ï¼ˆä»…ç¾¤å†…å®¹ï¼‰
    reports: number;            // ä¸¾æŠ¥æ•°ï¼ˆè´Ÿæƒé‡ï¼‰
    blocks: number;             // æ‹‰é»‘æ•°ï¼ˆè´Ÿæƒé‡ï¼‰
  };
  
  // å¤šæ ·æ€§çº¦æŸ
  diversity: {
    maxPerAuthor: number;       // åŒä½œè€…æ¯å±æœ€å¤š m æ¡
    maxPerSource: number;       // åŒæ¥æºæ¯å±æœ€å¤š n æ¡
    exploreRatio: number;       // æ¢ç´¢å†…å®¹å æ¯”
  };
}
```

**å±•ç¤ºå½¢å¼**:
- ç€‘å¸ƒæµå¸ƒå±€
- å›¾æ–‡æ··æ’
- è§†é¢‘è‡ªåŠ¨æ’­æ”¾ï¼ˆé™éŸ³ï¼‰
- æ‡’åŠ è½½

#### æœ€æ–°æµï¼ˆçº¯æ—¶é—´çº¿ï¼‰

**æ’åºè§„åˆ™**:
- æŒ‰å‘å¸ƒæ—¶é—´å€’åº
- ä¸åšç®—æ³•æ¨è
- ä¸åšçƒ­åº¦æ’åº

**ç”¨é€”**:
- æŸ¥çœ‹æœ€æ–°å†…å®¹
- é¿å…ç®—æ³•èŒ§æˆ¿

---

### 3ï¸âƒ£ åŸºç¡€äº’åŠ¨ (Engagement)

#### ç‚¹èµï¼ˆå…¬å¼€ï¼‰

```typescript
interface Like {
  postId: string;
  userId: string;
  likedAt: Date;
  
  // ç»Ÿè®¡
  likeCount: number;            // ç‚¹èµæ€»æ•°
}
```

**ç‰¹æ€§**:
- å…¬å¼€å¯è§
- å¯å–æ¶ˆ
- ä¸æ˜¾ç¤ºç‚¹èµç”¨æˆ·åˆ—è¡¨ï¼ˆé¿å…ç¤¾äº¤å‹åŠ›ï¼‰

#### æ”¶è—ï¼ˆç§æœ‰ï¼‰

```typescript
interface Save {
  postId: string;
  userId: string;
  savedAt: Date;
  
  // æ”¶è—å¤¹
  folderId?: string;
  folderName?: string;
}
```

**ç‰¹æ€§**:
- ç§æœ‰ä¸å¯è§
- å¯åˆ†ç±»æ”¶è—
- é«˜æƒé‡ä¿¡å·ï¼ˆç®—æ³•é‡è¦æŒ‡æ ‡ï¼‰


#### è½¬å‘/åˆ†äº«

```typescript
interface Repost {
  postId: string;
  userId: string;
  repostType: 'to_square' | 'to_chat' | 'copy_link';
  
  // è½¬å‘åˆ°å¹¿åœº
  repostToSquare?: {
    comment?: string;           // è½¬å‘è¯„è®º
    repostedAt: Date;
  };
  
  // è½¬å‘åˆ°ç¾¤/é¢‘é“
  repostToChat?: {
    chatId: string;
    chatTitle: string;
    repostedAt: Date;
  };
}
```

**è½¬å‘ç±»å‹**:
1. **è½¬å‘åˆ°å¹¿åœº** - å¸¦è¯„è®ºè½¬å‘
2. **è½¬å‘åˆ°ç¾¤/é¢‘é“** - å¡ç‰‡å½¢å¼
3. **å¤åˆ¶é“¾æ¥** - åˆ†äº«åˆ°å¤–éƒ¨

#### ä¸¾æŠ¥

```typescript
interface Report {
  postId: string;
  reportedBy: string;
  reason: 'spam' | 'harassment' | 'violence' | 'pornography' | 'illegal' | 'other';
  description?: string;
  reportedAt: Date;
  
  // å¤„ç†çŠ¶æ€
  status: 'pending' | 'reviewing' | 'resolved' | 'dismissed';
  handledBy?: string;
  handledAt?: Date;
}
```

**ä¸¾æŠ¥åŸå› **:
- åƒåœ¾ä¿¡æ¯
- éªšæ‰°
- æš´åŠ›å†…å®¹
- è‰²æƒ…å†…å®¹
- è¿æ³•ä¿¡æ¯
- å…¶ä»–

---

### 4ï¸âƒ£ Context Tagï¼ˆæ¥æºæ ‡è¯†ï¼‰

#### æ¥æºç±»å‹

```typescript
interface SourceTag {
  type: 'personal' | 'chat' | 'channel';
  
  // ä¸ªäººå¹¿æ’­
  personal?: {
    userId: string;
    username: string;
    displayName: string;
  };
  
  // ç¾¤/é¢‘é“åŒæ­¥
  chatOrChannel?: {
    chatId: string;
    chatTitle: string;
    chatUsername?: string;
    chatType: 'group' | 'supergroup' | 'channel';
    memberCount: number;
    description?: string;
  };
}
```

#### å±•ç¤ºå½¢å¼

**ä¸ªäººå¹¿æ’­**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¤ @username                    â”‚
â”‚    ä¸ªäººå¹¿æ’­                      â”‚
â”‚                                 â”‚
â”‚ [å†…å®¹]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¾¤/é¢‘é“åŒæ­¥**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“¢ æ¥è‡ª æŠ€æœ¯äº¤æµç¾¤               â”‚
â”‚    @tech_chat Â· 1.2K æˆå‘˜       â”‚
â”‚    [å»ç¾¤é‡Œè®¨è®º] [åŠ å…¥ç¾¤ç»„]       â”‚
â”‚                                 â”‚
â”‚ [å†…å®¹]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç‚¹å‡»æ¥æº

**ä¸ªäººå¹¿æ’­** â†’ ç”¨æˆ·ä¸ªäººé¡µ  
**ç¾¤/é¢‘é“åŒæ­¥** â†’ ç¾¤/é¢‘é“è¯´æ˜é¡µ

**ç¾¤/é¢‘é“è¯´æ˜é¡µ**:
```typescript
interface ChatInfoPage {
  chatId: string;
  chatTitle: string;
  chatUsername?: string;
  description: string;
  memberCount: number;
  
  // æ“ä½œæŒ‰é’®
  actions: {
    join: boolean;              // åŠ å…¥ç¾¤ç»„
    subscribe: boolean;         // è®¢é˜…é¢‘é“
    viewInApp: boolean;         // åœ¨åº”ç”¨ä¸­æŸ¥çœ‹
  };
  
  // ä¸å¼ºåˆ¶å…¥ç¾¤å³å¯æµè§ˆ
  requireJoin: false;
}
```

---

### 5ï¸âƒ£ æ²»ç†åº•åº§ (Safety Baseline)

#### æ‹‰é»‘ç”¨æˆ·

```typescript
interface BlockUser {
  blockedUserId: string;
  blockedBy: string;
  blockedAt: Date;
  
  // æ•ˆæœ
  effects: {
    hideSquareContent: boolean; // ä¸å†çœ‹åˆ°å¯¹æ–¹å¹¿åœºå†…å®¹
    hideComments: boolean;      // ä¸å†çœ‹åˆ°å¯¹æ–¹è¯„è®º
    preventInteraction: boolean;// å¯¹æ–¹æ— æ³•ä¸æˆ‘äº’åŠ¨
  };
}
```

#### å±è”½æ¥æº

```typescript
interface BlockSource {
  sourceType: 'chat' | 'channel';
  sourceId: string;
  blockedBy: string;
  blockedAt: Date;
  
  // æ•ˆæœ
  effects: {
    hideSquareContent: boolean; // ä¸çœ‹è¯¥ç¾¤/é¢‘é“çš„å…¬å¼€åŒæ­¥å†…å®¹
    hideRecommendations: boolean;// ä¸æ¨èè¯¥ç¾¤/é¢‘é“
  };
}
```

#### é¢‘æ§ï¼ˆé˜²åˆ·å±ï¼‰

```typescript
interface RateLimit {
  // å‘å¸–é™åˆ¶
  postLimit: {
    maxPerHour: number;         // æ¯å°æ—¶æœ€å¤š 5 æ¡
    maxPerDay: number;          // æ¯å¤©æœ€å¤š 20 æ¡
  };
  
  // è½¬å‘é™åˆ¶
  repostLimit: {
    maxPerHour: number;         // æ¯å°æ—¶æœ€å¤š 10 æ¬¡
  };
  
  // è¯„è®ºé™åˆ¶
  commentLimit: {
    maxPerHour: number;         // æ¯å°æ—¶æœ€å¤š 30 æ¡
  };
  
  // æ–°å·é™åˆ¶
  newUserRestrictions: {
    cooldownHours: number;      // å†·å´æœŸ 24 å°æ—¶
    uploadLimit: boolean;       // é™åˆ¶ä¸Šä¼ å›¾ç‰‡/è§†é¢‘
    linkLimit: boolean;         // é™åˆ¶å¤–é“¾
  };
}
```

---

## ğŸŸ§ P1 åŠŸèƒ½è¯¦ç»†è®¾è®¡

### 6ï¸âƒ£ ç”¨æˆ·ä¾§å†…å®¹æ§åˆ¶

#### ä¸æ„Ÿå…´è¶£

```typescript
interface NotInterested {
  postId: string;
  userId: string;
  reason?: 'not_relevant' | 'seen_too_much' | 'dont_like_author' | 'other';
  markedAt: Date;
  
  // æ•ˆæœ
  effects: {
    hideThisPost: boolean;      // éšè—è¿™æ¡å†…å®¹
    reduceSimilar: boolean;     // é™ä½ç›¸ä¼¼å†…å®¹
    reduceSameAuthor: boolean;  // é™ä½åŒä½œè€…å†…å®¹
  };
}
```

#### å±è”½æŸç”¨æˆ·çš„å¹¿åœºå†…å®¹

```typescript
interface MuteUserSquare {
  mutedUserId: string;
  mutedBy: string;
  mutedAt: Date;
  
  // ä¸æ‹‰é»‘çš„åŒºåˆ«
  differences: {
    canStillChat: boolean;      // ä»å¯ç§èŠ
    canStillInGroup: boolean;   // ä»å¯åœ¨åŒä¸€ç¾¤
    onlyHideSquare: boolean;    // åªéšè—å¹¿åœºå†…å®¹
  };
}
```


---

### 7ï¸âƒ£ æµè§ˆä¸å‘ç°ï¼ˆå…‹åˆ¶ç‰ˆï¼‰

#### æœ€æ–° / çƒ­é—¨åˆ‡æ¢

```typescript
interface FeedMode {
  mode: 'recommended' | 'latest' | 'hot';
  
  // æ¨èæµï¼ˆé»˜è®¤ï¼‰
  recommended: {
    algorithm: 'personalized';
    factors: ['saves', 'reposts', 'dwell', 'joinClicks'];
  };
  
  // æœ€æ–°æµ
  latest: {
    sortBy: 'publishedAt';
    order: 'desc';
  };
  
  // çƒ­é—¨æµï¼ˆå¼±ç®—æ³•ï¼‰
  hot: {
    timeWindow: '24h' | '7d' | '30d';
    sortBy: 'hotScore';
    hotScoreFormula: 'saves * 3 + reposts * 2 + likes * 1 - reports * 10';
  };
}
```

#### å†…å®¹ç±»å‹ç­›é€‰

```typescript
interface ContentFilter {
  contentTypes: ('text' | 'image' | 'video' | 'mixed')[];
  
  // ç­›é€‰é€‰é¡¹
  filters: {
    textOnly: boolean;          // åªçœ‹æ–‡å­—
    withImages: boolean;        // åŒ…å«å›¾ç‰‡
    withVideos: boolean;        // åŒ…å«è§†é¢‘
  };
}
```

#### æ¥æºç­›é€‰ï¼ˆå¯é€‰ï¼‰

```typescript
interface SourceFilter {
  sourceTypes: ('personal' | 'chat' | 'channel')[];
  
  // æŒ‰ç¾¤/é¢‘é“ç­›é€‰
  specificSources?: {
    chatId: string;
    chatTitle: string;
  }[];
}
```

---

### 8ï¸âƒ£ è½»è¯„è®ºï¼ˆå•å±‚ï¼Œæ— ç›–æ¥¼ï¼‰

#### è¯„è®ºè®¾è®¡åŸåˆ™

> **è¯„è®ºæ˜¯"å›åº”è¡¨è¾¾"ï¼Œä¸æ˜¯"äº‰å¤ºè¯è¯­æƒ"**

**æ ¸å¿ƒç‰¹æ€§**:
1. **å•å±‚è¯„è®º** - æ‰€æœ‰è¯„è®ºåœ¨åŒä¸€å±‚
2. **ä¸ç›–æ¥¼** - ä¸æ”¯æŒè¯„è®ºå›å¤è¯„è®º
3. **æ— çƒ­è¯„** - ä¸åš"æœ€çƒ­è¯„è®º"æ’åº
4. **å›åº”ä½œè€…** - å¿ƒæ™ºå¼•å¯¼ï¼šå›åº”å†…å®¹ï¼Œä¸æ˜¯å†™ç»™è§‚ä¼—

#### è¯„è®ºæ•°æ®ç»“æ„

```typescript
interface Comment {
  commentId: string;
  postId: string;
  userId: string;
  username: string;
  
  // è¯„è®ºå†…å®¹
  text: string;                 // æœ€å¤š 500 å­—
  createdAt: Date;
  
  // ç¼–è¾‘
  edited: boolean;
  editedAt?: Date;
  
  // äº’åŠ¨ï¼ˆå…‹åˆ¶ï¼‰
  likeCount: number;            // å¯ç‚¹èµï¼Œä½†ä¸ä½œä¸ºæ’åºä¾æ®
  
  // çŠ¶æ€
  status: 'normal' | 'hidden' | 'deleted';
  hiddenReason?: string;
}
```

#### è¯„è®ºæ’åº

```typescript
interface CommentSorting {
  sortBy: 'time' | 'author_first';
  
  // æŒ‰æ—¶é—´ï¼ˆé»˜è®¤ï¼‰
  time: {
    order: 'asc' | 'desc';      // é»˜è®¤ ascï¼ˆæœ€æ—©çš„åœ¨å‰ï¼‰
  };
  
  // ä½œè€…ä¼˜å…ˆ + æ—¶é—´
  authorFirst: {
    authorComments: Comment[];  // ä½œè€…çš„è¯„è®ºç½®é¡¶
    otherComments: Comment[];   // å…¶ä»–è¯„è®ºæŒ‰æ—¶é—´æ’åº
  };
}
```

**ä¸åšçš„**:
- âŒ æœ€çƒ­è¯„è®º
- âŒ ç‚¹èµæœ€å¤šçš„è¯„è®ºç½®é¡¶
- âŒ è¯„è®ºå›å¤è¯„è®ºï¼ˆç›–æ¥¼ï¼‰
- âŒ è¯„è®ºåŒºæƒåŠ›ç»“æ„

#### UI è®¾è®¡

**è¾“å…¥æ¡†æç¤º**:
```
ã€Œå›åº”è¿™æ¡å†…å®¹â€¦ã€
```

**è€Œä¸æ˜¯**:
```
ã€Œå†™ä¸‹ä½ çš„çœ‹æ³•ã€
ã€Œå‘è¡¨è¯„è®ºã€
```

**è¯„è®ºå±•ç¤º**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ‘¤ @username Â· 2å°æ—¶å‰          â”‚
â”‚    è¿™æ˜¯ä¸€æ¡è¯„è®ºå†…å®¹              â”‚
â”‚    ğŸ‘ 12                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¯„è®ºä¸ç¾¤/ç§èŠçš„å…³ç³»

**è¯„è®ºçš„ä½œç”¨**:
- "æˆ‘å¯¹ä½ è¯´çš„è¯æœ‰ååº”ï¼Œä½†è¿™æ®µè¯ä¸å€¼å¾—å ç”¨ä¸€ä¸ªç¾¤"

**å½“å‡ºç°ä»¥ä¸‹æƒ…å†µæ—¶**:
- å¤šè½®å¯¹è¯
- æ˜ç¡®ä¸»é¢˜
- å¤šäººå‚ä¸

**æ­£ç¡®çš„å¼•å¯¼**:
```
ã€Œå»ç¾¤é‡Œç»§ç»­è®¨è®ºã€
ã€Œåˆ›å»ºä¸€ä¸ªç¾¤ç»§ç»­èŠã€
```

**è¯„è®ºæ˜¯ç¼“å†²å±‚ï¼Œä¸æ˜¯ç»ˆç‚¹**

---

### 9ï¸âƒ£ å¹¿åœº â†” ç¾¤å›æµ

#### å¯¹"ç¾¤/é¢‘é“åŒæ­¥å†…å®¹"çš„å›æµ

```typescript
interface ChatBackflow {
  // å¼ºå±•ç¤º
  actions: {
    goToChat: {
      label: 'å»ç¾¤é‡Œè®¨è®º';
      action: 'open_chat';
      chatId: string;
    };
    joinChat: {
      label: 'åŠ å…¥ç¾¤ç»„' | 'è®¢é˜…é¢‘é“';
      action: 'join_chat';
      chatId: string;
    };
  };
  
  // ç»Ÿè®¡
  metrics: {
    viewCount: number;          // æµè§ˆæ•°
    joinClickCount: number;     // ç‚¹å‡»"åŠ å…¥"æ¬¡æ•°
    joinSuccessCount: number;   // æˆåŠŸåŠ å…¥æ•°
    joinCVR: number;            // åŠ å…¥è½¬åŒ–ç‡
  };
}
```

#### å¯¹"ä¸ªäººå¹¿æ’­"çš„å›æµï¼ˆå¯é€‰ï¼‰

```typescript
interface PersonalBackflow {
  // å¼±å¼•å¯¼ï¼Œä¸å¼ºåˆ¶ç»‘å®š
  relatedChats?: {
    chatId: string;
    chatTitle: string;
    relevance: number;          // ç›¸å…³åº¦
    reason: string;             // æ¨èç†ç”±
  }[];
  
  // ä¸ä»¥ç²‰ä¸å…³ç³»ä½œä¸ºä¸»åˆ†å‘é€»è¾‘
  followRelation: {
    useForDistribution: false;  // ä¸ç”¨äºåˆ†å‘
    useForPersonalization: true;// ä»…ç”¨äºä¸ªæ€§åŒ–
  };
}
```

---

### ğŸ”Ÿ ä¸ªäººé¡µï¼ˆå…‹åˆ¶ä½†å¯ç”¨ï¼‰

#### ä¸ªäººé¡µè®¾è®¡

```typescript
interface UserProfilePage {
  userId: string;
  username: string;
  displayName: string;
  bio?: string;
  avatar?: string;
  
  // ç»Ÿè®¡ï¼ˆå…‹åˆ¶ï¼‰
  stats: {
    postCount: number;          // å‘å¸ƒæ•°
    // ä¸æ˜¾ç¤ºç²‰ä¸æ•°
    // ä¸æ˜¾ç¤ºç‚¹èµæ€»æ•°
  };
  
  // å…¬å¼€å†…å®¹
  publicPosts: Post[];          // å¹¿åœºå†…å®¹
  
  // å…³æ³¨ï¼ˆå¯é€‰ï¼‰
  followable: boolean;
  followerCount?: number;       // å¯é€‰æ˜¾ç¤º
  followingCount?: number;      // å¯é€‰æ˜¾ç¤º
}
```

**ä¸ä»¥ç²‰ä¸å…³ç³»ä½œä¸ºå¹¿åœºä¸»åˆ†å‘é€»è¾‘**:
- å…³æ³¨åªå½±å“ä¸ªæ€§åŒ–æ¨è
- ä¸å½±å“å†…å®¹æ›å…‰æƒé‡
- é¿å…æ›å…‰å†…å·

---

## ğŸ¯ æ ¸å¿ƒ KPI

### å†…å®¹ä»·å€¼æŒ‡æ ‡

```typescript
interface ContentKPI {
  // æœ‰æ•ˆåœç•™
  dwell: {
    avgDwellTime: number;       // å¹³å‡åœç•™æ—¶é•¿ï¼ˆç§’ï¼‰
    completionRate: number;     // å®Œæ•´æµè§ˆç‡
  };
  
  // æ”¶è—ç‡ï¼ˆé«˜æƒé‡ï¼‰
  saveRate: {
    saves: number;
    views: number;
    saveRate: number;           // saves / views
  };
  
  // è½¬å‘ç‡
  repostRate: {
    reposts: number;
    views: number;
    repostRate: number;         // reposts / views
  };
  
  // å›æµç‡ï¼ˆå¯¹ç¾¤å†…å®¹ï¼‰
  joinRate: {
    joinClicks: number;
    joinSuccess: number;
    views: number;
    joinCTR: number;            // joinClicks / views
    joinCVR: number;            // joinSuccess / joinClicks
  };
  
  // ä½ä¸¾æŠ¥ç‡ï¼ˆè´Ÿå‘æŒ‡æ ‡ï¼‰
  reportRate: {
    reports: number;
    views: number;
    reportRate: number;         // reports / viewsï¼ˆè¶Šä½è¶Šå¥½ï¼‰
  };
}
```

### å¹³å°å¥åº·æŒ‡æ ‡

```typescript
interface PlatformHealthKPI {
  // å†…å®¹è´¨é‡
  contentQuality: {
    avgSaveRate: number;        // å¹³å‡æ”¶è—ç‡
    avgRepostRate: number;      // å¹³å‡è½¬å‘ç‡
    avgReportRate: number;      // å¹³å‡ä¸¾æŠ¥ç‡
  };
  
  // ç”¨æˆ·æ´»è·ƒ
  userEngagement: {
    dau: number;                // æ—¥æ´»
    avgSessionTime: number;     // å¹³å‡ä¼šè¯æ—¶é•¿
    returnRate: number;         // æ¬¡æ—¥ç•™å­˜
  };
  
  // å›æµæ•ˆæœ
  backflowEffect: {
    avgJoinCTR: number;         // å¹³å‡å…¥ç¾¤ç‚¹å‡»ç‡
    avgJoinCVR: number;         // å¹³å‡å…¥ç¾¤è½¬åŒ–ç‡
    newGroupMembers: number;    // é€šè¿‡å¹¿åœºåŠ å…¥çš„æ–°æˆå‘˜
  };
}
```


---

## ğŸ“ æ¨èç®—æ³•è®¾è®¡

### Phase 0 - è§„åˆ™æ¨èï¼ˆP0 åŒæ­¥ä¸Šçº¿ï¼‰

#### å€™é€‰é›† (Candidates)

å€Ÿé‰´ X çš„ in-network / out-of-network æ€è·¯ï¼Œä½†å®ç°è½»é‡ï¼š

```typescript
interface CandidatePool {
  // IN: ç”¨æˆ·å·²åŠ å…¥çš„ç¾¤/é¢‘é“å…¬å¼€å†…å®¹
  inNetwork: {
    source: 'joined_chats';
    posts: Post[];
    weight: number;             // æƒé‡ï¼š0.6
  };
  
  // OUT-1: å…¨ç«™ä¸ªäººå¹¿æ’­å†…å®¹æ± 
  outNetworkPersonal: {
    source: 'all_personal_posts';
    posts: Post[];
    weight: number;             // æƒé‡ï¼š0.2
  };
  
  // OUT-2: å…¨ç«™ç¾¤/é¢‘é“åŒæ­¥å†…å®¹æ± 
  outNetworkChats: {
    source: 'all_chat_posts';
    posts: Post[];
    weight: number;             // æƒé‡ï¼š0.2
  };
}
```

#### è¿‡æ»¤ (Filters)

```typescript
interface ContentFilters {
  // é»‘åå•è¿‡æ»¤
  blacklist: {
    blockedUsers: string[];
    blockedSources: string[];
    mutedUsers: string[];
  };
  
  // é£æ§è¿‡æ»¤
  riskControl: {
    lowReputationUsers: boolean;    // ä½ä¿¡èª‰è´¦å·é™æƒ
    highRiskContent: boolean;       // é«˜é£é™©å†…å®¹æ‹¦æˆª
    spamDetection: boolean;         // åƒåœ¾å†…å®¹æ£€æµ‹
  };
  
  // å»é‡ä¸ååˆ·å±
  deduplication: {
    sameAuthorDecay: {
      enabled: boolean;
      maxConsecutive: number;       // åŒä½œè€…è¿ç»­å‡ºç°ä¸Šé™
      decayFactor: number;          // è¡°å‡ç³»æ•°
    };
    sameSourceDecay: {
      enabled: boolean;
      maxConsecutive: number;       // åŒæ¥æºè¿ç»­å‡ºç°ä¸Šé™
      decayFactor: number;
    };
  };
  
  // æ—¶æ•ˆç­–ç•¥
  timeDecay: {
    enabled: boolean;
    halfLife: number;               // åŠè¡°æœŸï¼ˆå°æ—¶ï¼‰
    formula: 'exponential' | 'linear';
  };
}
```

#### è¯„åˆ† (Scoring) - çº¿æ€§å¯è§£é‡Š

```typescript
interface ScoringModel {
  // è¯„åˆ†å…¬å¼
  formula: string;  // Score = w1Â·Recency + w2Â·Likes + w3Â·Reposts + w4Â·Saves + ...
  
  // æƒé‡é…ç½®
  weights: {
    recency: number;                // w1 = 1.0
    likes: number;                  // w2 = 0.5
    reposts: number;                // w3 = 2.0
    saves: number;                  // w4 = 3.0 (é«˜æƒé‡)
    dwell: number;                  // w5 = 1.5
    followAffinity: number;         // w6 = 0.3 (ä½æƒé‡ï¼Œå¯é€‰)
    joinClicks: number;             // w7 = 5.0 (ä»…å¯¹ç¾¤/é¢‘é“å†…å®¹)
    reports: number;                // w8 = -10.0 (å¼ºè´Ÿæƒé‡)
    blocks: number;                 // w9 = -15.0 (å¼ºè´Ÿæƒé‡)
    spamRisk: number;               // w10 = -20.0 (å¼ºè´Ÿæƒé‡)
  };
  
  // æƒé‡åŸåˆ™
  principles: {
    savesOverLikes: boolean;        // æ”¶è—æƒé‡ > ç‚¹èµæƒé‡
    joinClicksHighest: boolean;     // å…¥ç¾¤ç‚¹å‡»æƒé‡æœ€é«˜ï¼ˆä»…ç¾¤å†…å®¹ï¼‰
    strongNegative: boolean;        // ä¸¾æŠ¥/æ‹‰é»‘/åƒåœ¾å¼ºè´Ÿæƒé‡
    followAffinityLow: boolean;     // å…³æ³¨äº²å’Œåº¦åªåšå¾®è°ƒ
  };
}
```

**è¯„åˆ†è®¡ç®—ç¤ºä¾‹**:
```typescript
function calculateScore(post: Post, user: User): number {
  const recencyScore = calculateRecency(post.publishedAt);
  const likesScore = post.likeCount * 0.5;
  const repostsScore = post.repostCount * 2.0;
  const savesScore = post.saveCount * 3.0;
  const dwellScore = post.avgDwellTime * 1.5;
  const followScore = isFollowing(user, post.author) ? 0.3 : 0;
  const joinScore = post.sourceType === 'chat' ? post.joinClickCount * 5.0 : 0;
  const reportPenalty = post.reportCount * -10.0;
  const blockPenalty = post.blockCount * -15.0;
  const spamPenalty = post.spamRiskScore * -20.0;
  
  return recencyScore + likesScore + repostsScore + savesScore + dwellScore 
         + followScore + joinScore + reportPenalty + blockPenalty + spamPenalty;
}
```

#### é€‰å– (Selector)

```typescript
interface ContentSelector {
  // TopK é€‰æ‹©
  topK: {
    k: number;                      // æ¯æ¬¡åŠ è½½ 20 æ¡
    minScore: number;               // æœ€ä½åˆ†æ•°é˜ˆå€¼
  };
  
  // å¤šæ ·æ€§çº¦æŸ
  diversity: {
    maxPerAuthor: number;           // åŒä½œè€…æ¯å±æœ€å¤š 2 æ¡
    maxPerSource: number;           // åŒæ¥æºæ¯å±æœ€å¤š 3 æ¡
    exploreRatio: number;           // æ¢ç´¢ä½å æ¯” 20%
  };
  
  // æ¢ç´¢ä½
  exploration: {
    enabled: boolean;
    ratio: number;                  // 0.2 (20%)
    strategy: 'random' | 'new_author' | 'new_source';
  };
}
```

---

### Phase 1 - è½»é‡å­¦ä¹ ï¼ˆP1 ä¸Šçº¿åï¼‰

#### æ¨¡å‹ A: ä»·å€¼é¢„æµ‹

```typescript
interface ValuePredictionModel {
  modelType: 'logistic_regression' | 'gradient_boosting';
  
  // é¢„æµ‹ç›®æ ‡
  targets: {
    p_save: number;               // æ”¶è—æ¦‚ç‡
    p_repost: number;             // è½¬å‘æ¦‚ç‡
    p_dwell: number;              // åœç•™æ—¶é•¿é¢„æµ‹
    p_reply: number;              // è¯„è®ºæ¦‚ç‡ï¼ˆå¯é€‰ï¼‰
  };
  
  // ç‰¹å¾
  features: {
    // å†…å®¹ç‰¹å¾
    contentLength: number;
    hasImages: boolean;
    hasVideo: boolean;
    imageCount: number;
    
    // ä½œè€…ç‰¹å¾
    authorPostCount: number;
    authorAvgSaveRate: number;
    authorReputation: number;
    
    // æ¥æºç‰¹å¾ï¼ˆå¦‚æœæ˜¯ç¾¤/é¢‘é“ï¼‰
    sourceMemberCount?: number;
    sourceActivityLevel?: number;
    
    // æ—¶é—´ç‰¹å¾
    hourOfDay: number;
    dayOfWeek: number;
    
    // ç”¨æˆ·ç‰¹å¾
    userInterestMatch: number;
    userHistoricalEngagement: number;
  };
}
```

#### æ¨¡å‹ B: å›æµé¢„æµ‹ï¼ˆå¯¹ç¾¤å†…å®¹ï¼‰

```typescript
interface BackflowPredictionModel {
  modelType: 'logistic_regression';
  
  // é¢„æµ‹ç›®æ ‡
  targets: {
    p_join_click: number;         // ç‚¹å‡»"åŠ å…¥"æ¦‚ç‡
    p_join_success: number;       // æˆåŠŸåŠ å…¥æ¦‚ç‡
  };
  
  // ç‰¹å¾
  features: {
    // ç¾¤/é¢‘é“ç‰¹å¾
    memberCount: number;
    activityLevel: number;
    contentQuality: number;
    
    // å†…å®¹ç‰¹å¾
    contentRelevance: number;
    contentQuality: number;
    
    // ç”¨æˆ·ç‰¹å¾
    userJoinedGroupCount: number;
    userInterestMatch: number;
  };
}
```

#### æ¨¡å‹ C: é£é™©é¢„æµ‹

```typescript
interface RiskPredictionModel {
  modelType: 'random_forest';
  
  // é¢„æµ‹ç›®æ ‡
  targets: {
    p_report: number;             // è¢«ä¸¾æŠ¥æ¦‚ç‡
    p_block: number;              // è¢«æ‹‰é»‘æ¦‚ç‡
    p_spam: number;               // åƒåœ¾å†…å®¹æ¦‚ç‡
  };
  
  // ç‰¹å¾
  features: {
    // å†…å®¹ç‰¹å¾
    hasExternalLinks: boolean;
    linkCount: number;
    suspiciousKeywords: number;
    
    // ä½œè€…ç‰¹å¾
    authorAge: number;            // è´¦å·å¹´é¾„
    authorReportHistory: number;
    authorReputationScore: number;
    
    // è¡Œä¸ºç‰¹å¾
    postFrequency: number;
    recentPostCount: number;
  };
}
```

#### æœ€ç»ˆæ‰“åˆ†ï¼ˆå¤šç›®æ ‡åŠ æƒï¼‰

```typescript
interface MultiObjectiveScoring {
  formula: string;  // Score = aÂ·p_save + bÂ·p_repost + cÂ·p_dwell + dÂ·p_join_success - eÂ·p_report - fÂ·p_block - gÂ·p_spam
  
  weights: {
    a: number;  // 3.0 (æ”¶è—)
    b: number;  // 2.0 (è½¬å‘)
    c: number;  // 1.5 (åœç•™)
    d: number;  // 5.0 (å…¥ç¾¤æˆåŠŸï¼Œä»…ç¾¤å†…å®¹)
    e: number;  // -10.0 (ä¸¾æŠ¥)
    f: number;  // -15.0 (æ‹‰é»‘)
    g: number;  // -20.0 (åƒåœ¾)
  };
  
  // ä¸æŠŠ"ç²‰ä¸æ•°"ä½œä¸ºæ ¸å¿ƒç‰¹å¾
  excludedFeatures: ['followerCount', 'followingCount'];
  
  // è®©æ¨èå­¦ä¹ "å†…å®¹ä»·å€¼ + å›æµä»·å€¼"
  objectives: ['content_value', 'backflow_value'];
}
```

---

### Phase 2 - è§„æ¨¡åå†ä¸Šå¤§æ¨¡å‹ï¼ˆP2 ä»¥åï¼‰

#### ä¸¤å¡”å¬å›

```typescript
interface TwoTowerRecall {
  // ç”¨æˆ·å¡”
  userTower: {
    embedding: number[];          // ç”¨æˆ·å‘é‡
    features: ['interests', 'behavior', 'demographics'];
  };
  
  // å†…å®¹å¡”
  contentTower: {
    embedding: number[];          // å†…å®¹å‘é‡
    features: ['text', 'images', 'source', 'author'];
  };
  
  // ç›¸ä¼¼åº¦è®¡ç®—
  similarity: 'cosine' | 'dot_product';
  
  // å¬å›ç­–ç•¥
  recall: {
    similarContent: Post[];       // ç›¸ä¼¼å†…å®¹
    similarCommunities: Chat[];   // ç›¸ä¼¼ç¤¾ç¾¤
  };
}
```

#### æ›´å¤æ‚æ’åºå™¨

å‚è€ƒ X çš„å·¥ç¨‹ä¸åˆ†å±‚ï¼Œä½†ä¿æŒç›®æ ‡å‡½æ•°ï¼šæ²‰æ·€ä¼˜å…ˆ

```typescript
interface AdvancedRanker {
  // å¤šé˜¶æ®µæ’åº
  stages: {
    stage1: 'candidate_generation';  // å€™é€‰ç”Ÿæˆ
    stage2: 'coarse_ranking';        // ç²—æ’
    stage3: 'fine_ranking';          // ç²¾æ’
    stage4: 'diversity_rerank';      // å¤šæ ·æ€§é‡æ’
  };
  
  // ä¿æŒç›®æ ‡å‡½æ•°
  objective: 'maximize_saves_and_backflow';
  
  // ä¸å˜åŸåˆ™
  principles: {
    noFollowerCountBias: boolean;    // ä¸åå‘é«˜ç²‰ä¸æ•°
    contentValueFirst: boolean;      // å†…å®¹ä»·å€¼ä¼˜å…ˆ
    backflowValueHigh: boolean;      // å›æµä»·å€¼é«˜æƒé‡
  };
}
```

---

### ç®—æ³•é…ç½®é¡¹ï¼ˆè¿è¥/é£æ§å¯æ§ï¼‰

```typescript
interface AlgorithmConfig {
  // æ¢ç´¢å æ¯”
  exploreRatio: number;           // 0.2 (20%)
  
  // å¤šæ ·æ€§çº¦æŸ
  authorCap: number;              // å•ä½œè€…æ¯å±ä¸Šé™ 2
  sourceCap: number;              // å•æ¥æºæ¯å±ä¸Šé™ 3
  
  // æ–°å·é™åˆ¶
  newUserThrottle: {
    cooldownHours: number;        // 24
    uploadLimit: boolean;         // true
    linkLimit: boolean;           // true
  };
  
  // é£é™©é˜ˆå€¼
  riskFloor: number;              // é£é™©åˆ†è¶…è¿‡é˜ˆå€¼ä¸è¿›å¹¿åœº
  
  // å›æµæƒé‡
  joinWeight: number;             // 5.0 (å¯¹ç¾¤å†…å®¹æœ€é«˜)
  
  // æ—¶é—´è¡°å‡
  recencyHalfLife: number;        // 24 (å°æ—¶)
  
  // å¯è°ƒå‚æ•°
  tunable: {
    saveWeight: [2.0, 4.0];       // å¯è°ƒèŒƒå›´
    repostWeight: [1.0, 3.0];
    joinWeight: [3.0, 7.0];
  };
}
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

```sql
-- å¹¿åœºå†…å®¹è¡¨
CREATE TABLE square_posts (
  post_id VARCHAR(255) PRIMARY KEY,
  author_id VARCHAR(255) NOT NULL,
  
  -- æ¥æº
  source_type VARCHAR(20) NOT NULL,  -- personal, chat, channel
  source_id VARCHAR(255),            -- ç¾¤/é¢‘é“ IDï¼ˆå¦‚æœæ˜¯åŒæ­¥å†…å®¹ï¼‰
  
  -- å†…å®¹
  content_type VARCHAR(20) NOT NULL, -- text, image, video, mixed
  text TEXT,
  images TEXT[],                     -- å›¾ç‰‡ URL æ•°ç»„
  video VARCHAR(255),
  
  -- çŠ¶æ€
  status VARCHAR(20) DEFAULT 'published',  -- draft, published, hidden, deleted
  
  -- äº’åŠ¨ç»Ÿè®¡
  like_count INTEGER DEFAULT 0,
  save_count INTEGER DEFAULT 0,
  repost_count INTEGER DEFAULT 0,
  comment_count INTEGER DEFAULT 0,
  view_count INTEGER DEFAULT 0,
  
  -- å›æµç»Ÿè®¡ï¼ˆä»…ç¾¤/é¢‘é“å†…å®¹ï¼‰
  join_click_count INTEGER DEFAULT 0,
  join_success_count INTEGER DEFAULT 0,
  
  -- æ²»ç†
  report_count INTEGER DEFAULT 0,
  block_count INTEGER DEFAULT 0,
  
  -- ç®—æ³•
  hot_score DECIMAL(10, 2) DEFAULT 0,
  quality_score DECIMAL(10, 2) DEFAULT 0,
  
  -- æ—¶é—´
  published_at TIMESTAMP NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  
  -- ç´¢å¼•
  INDEX idx_author (author_id),
  INDEX idx_source (source_type, source_id),
  INDEX idx_published (published_at DESC),
  INDEX idx_hot_score (hot_score DESC),
  INDEX idx_status (status)
);

-- è¯„è®ºè¡¨
CREATE TABLE square_comments (
  comment_id VARCHAR(255) PRIMARY KEY,
  post_id VARCHAR(255) NOT NULL,
  user_id VARCHAR(255) NOT NULL,
  
  -- å†…å®¹
  text TEXT NOT NULL,
  
  -- äº’åŠ¨
  like_count INTEGER DEFAULT 0,
  
  -- çŠ¶æ€
  status VARCHAR(20) DEFAULT 'normal',  -- normal, hidden, deleted
  edited BOOLEAN DEFAULT FALSE,
  edited_at TIMESTAMP,
  
  -- æ—¶é—´
  created_at TIMESTAMP DEFAULT NOW(),
  
  -- ç´¢å¼•
  INDEX idx_post (post_id, created_at),
  INDEX idx_user (user_id),
  FOREIGN KEY (post_id) REFERENCES square_posts(post_id)
);

-- äº’åŠ¨è®°å½•è¡¨
CREATE TABLE square_interactions (
  interaction_id SERIAL PRIMARY KEY,
  post_id VARCHAR(255) NOT NULL,
  user_id VARCHAR(255) NOT NULL,
  
  -- äº’åŠ¨ç±»å‹
  interaction_type VARCHAR(20) NOT NULL,  -- like, save, repost, view, join_click
  
  -- å…ƒæ•°æ®
  metadata JSONB,
  
  -- æ—¶é—´
  created_at TIMESTAMP DEFAULT NOW(),
  
  -- ç´¢å¼•
  INDEX idx_post_user (post_id, user_id, interaction_type),
  INDEX idx_user_type (user_id, interaction_type, created_at),
  UNIQUE (post_id, user_id, interaction_type)
);

-- ç”¨æˆ·æ§åˆ¶è¡¨
CREATE TABLE square_user_controls (
  user_id VARCHAR(255) PRIMARY KEY,
  
  -- æ‹‰é»‘/å±è”½
  blocked_users TEXT[],
  blocked_sources TEXT[],
  muted_users TEXT[],
  
  -- ä¸æ„Ÿå…´è¶£
  not_interested_posts TEXT[],
  
  -- æ›´æ–°æ—¶é—´
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ç¾¤/é¢‘é“åŒæ­¥è®¾ç½®è¡¨
CREATE TABLE square_chat_sync_settings (
  chat_id VARCHAR(255) PRIMARY KEY,
  
  -- åŒæ­¥è®¾ç½®
  sync_enabled BOOLEAN DEFAULT FALSE,
  auto_sync BOOLEAN DEFAULT FALSE,
  
  -- æƒé™
  allowed_users TEXT[],           -- å…è®¸åŒæ­¥çš„ç”¨æˆ·
  
  -- ç»Ÿè®¡
  synced_post_count INTEGER DEFAULT 0,
  total_join_count INTEGER DEFAULT 0,
  
  -- æ—¶é—´
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```


---

## ğŸ¨ å‰ç«¯é¡µé¢è®¾è®¡

### é¡µé¢ç»“æ„

```
Echo Square/
â”œâ”€â”€ /square                     # å¹¿åœºé¦–é¡µ
â”‚   â”œâ”€â”€ æ¨èæµï¼ˆé»˜è®¤ï¼‰
â”‚   â”œâ”€â”€ æœ€æ–°æµ
â”‚   â””â”€â”€ çƒ­é—¨æµ
â”‚
â”œâ”€â”€ /square/post/:id            # å¸–å­è¯¦æƒ…é¡µ
â”‚   â”œâ”€â”€ å†…å®¹å±•ç¤º
â”‚   â”œâ”€â”€ è¯„è®ºåˆ—è¡¨
â”‚   â””â”€â”€ ç›¸å…³æ¨è
â”‚
â”œâ”€â”€ /square/publish             # å‘å¸ƒé¡µ
â”‚   â”œâ”€â”€ ä¸ªäººå¹¿æ’­
â”‚   â””â”€â”€ ç¾¤/é¢‘é“åŒæ­¥
â”‚
â”œâ”€â”€ /square/user/:id            # ç”¨æˆ·ä¸ªäººé¡µ
â”‚   â”œâ”€â”€ å…¬å¼€å†…å®¹
â”‚   â””â”€â”€ ç»Ÿè®¡ä¿¡æ¯
â”‚
â””â”€â”€ /square/chat/:id            # ç¾¤/é¢‘é“è¯´æ˜é¡µ
    â”œâ”€â”€ åŸºæœ¬ä¿¡æ¯
    â”œâ”€â”€ å…¬å¼€å†…å®¹
    â””â”€â”€ åŠ å…¥/è®¢é˜…æŒ‰é’®
```

### ç»„ä»¶è®¾è®¡

#### PostCard ç»„ä»¶

```typescript
interface PostCardProps {
  post: {
    postId: string;
    author: {
      userId: string;
      username: string;
      displayName: string;
      avatar: string;
    };
    source: {
      type: 'personal' | 'chat' | 'channel';
      chatId?: string;
      chatTitle?: string;
    };
    content: {
      type: 'text' | 'image' | 'video' | 'mixed';
      text?: string;
      images?: string[];
      video?: string;
    };
    stats: {
      likeCount: number;
      saveCount: number;
      repostCount: number;
      commentCount: number;
    };
    publishedAt: Date;
  };
  
  // æ“ä½œå›è°ƒ
  onLike: () => void;
  onSave: () => void;
  onRepost: () => void;
  onComment: () => void;
  onReport: () => void;
  onBlock: () => void;
}
```

#### CommentList ç»„ä»¶

```typescript
interface CommentListProps {
  postId: string;
  comments: Comment[];
  sortBy: 'time' | 'author_first';
  
  // æ“ä½œå›è°ƒ
  onSubmitComment: (text: string) => void;
  onLikeComment: (commentId: string) => void;
  onReportComment: (commentId: string) => void;
}
```

---

## ğŸ” æƒé™ä¸å®‰å…¨

### å‘å¸ƒæƒé™

```typescript
interface PublishPermissions {
  // æ–°ç”¨æˆ·é™åˆ¶
  newUser: {
    cooldownHours: number;        // 24 å°æ—¶å†·å´æœŸ
    canUploadImages: boolean;     // é™åˆ¶ä¸Šä¼ å›¾ç‰‡
    canUploadVideos: boolean;     // é™åˆ¶ä¸Šä¼ è§†é¢‘
    canPostLinks: boolean;        // é™åˆ¶å¤–é“¾
  };
  
  // é¢‘ç‡é™åˆ¶
  rateLimit: {
    maxPostsPerHour: number;      // æ¯å°æ—¶ 5 æ¡
    maxPostsPerDay: number;       // æ¯å¤© 20 æ¡
    maxRepostsPerHour: number;    // æ¯å°æ—¶ 10 æ¬¡
    maxCommentsPerHour: number;   // æ¯å°æ—¶ 30 æ¡
  };
  
  // å†…å®¹å®¡æ ¸
  moderation: {
    sensitiveWordFilter: boolean;
    imageModeration: boolean;
    videoModeration: boolean;
  };
}
```

### ç¾¤/é¢‘é“åŒæ­¥æƒé™

```typescript
interface ChatSyncPermissions {
  // è°å¯ä»¥å¼€å¯åŒæ­¥
  canEnableSync: 'creator' | 'admin' | 'all';
  
  // è°å¯ä»¥åŒæ­¥å†…å®¹
  canSyncContent: 'creator' | 'admin' | 'all' | 'whitelist';
  
  // ç™½åå•
  whitelist: string[];
  
  // å®¡æ ¸
  requireApproval: boolean;
}
```

---

## ğŸ“Š ç®¡ç†åå°åŠŸèƒ½

### å¹¿åœºå†…å®¹æ± ç®¡ç†

**è·¯ç”±**: `/admin/square/pool`

```typescript
interface SquareContentManagement {
  // å†…å®¹åˆ—è¡¨
  contentList: {
    postId: string;
    author: string;
    sourceType: string;
    status: string;
    hotScore: number;
    viewCount: number;
    reportCount: number;
    publishedAt: Date;
  }[];
  
  // æ“ä½œ
  actions: {
    approve: (postId: string) => void;
    reject: (postId: string, reason: string) => void;
    hide: (postId: string, reason: string) => void;
    delete: (postId: string, reason: string) => void;
    pin: (postId: string) => void;
    adjustHotScore: (postId: string, score: number) => void;
  };
}
```

### å¹¿åœºå®¡æ ¸é˜Ÿåˆ—

**è·¯ç”±**: `/admin/square/moderation`

```typescript
interface SquareModerationQueue {
  // å¾…å®¡æ ¸å†…å®¹
  pendingReviews: {
    postId: string;
    author: string;
    content: string;
    riskLevel: 'low' | 'medium' | 'high';
    riskReasons: string[];
    submittedAt: Date;
  }[];
  
  // æ“ä½œ
  actions: {
    approve: (postId: string) => void;
    reject: (postId: string, reason: string) => void;
    requestModification: (postId: string, note: string) => void;
    markRisk: (postId: string, level: string) => void;
  };
}
```

### ç®—æ³•é…ç½®

**è·¯ç”±**: `/admin/square/algorithm`

```typescript
interface AlgorithmConfiguration {
  // æƒé‡é…ç½®
  weights: {
    saves: number;
    reposts: number;
    dwell: number;
    joinClicks: number;
    reports: number;
    blocks: number;
  };
  
  // å¤šæ ·æ€§é…ç½®
  diversity: {
    exploreRatio: number;
    authorCap: number;
    sourceCap: number;
  };
  
  // é£æ§é…ç½®
  riskControl: {
    riskFloor: number;
    newUserCooldown: number;
  };
  
  // æ“ä½œ
  actions: {
    updateWeights: (weights: Record<string, number>) => void;
    resetToDefault: () => void;
    exportConfig: () => void;
    importConfig: (config: AlgorithmConfig) => void;
  };
}
```

---

## ğŸš€ å®æ–½è·¯çº¿å›¾

### Phase 1: P0 æ ¸å¿ƒåŠŸèƒ½ï¼ˆ4-5 å‘¨ï¼‰

**Week 1-2: åŸºç¡€æ¶æ„**
- âœ… æ•°æ®åº“è®¾è®¡ä¸è¿ç§»
- âœ… åç«¯ API å¼€å‘ï¼ˆå‘å¸ƒã€ä¿¡æ¯æµã€äº’åŠ¨ï¼‰
- âœ… å‰ç«¯åŸºç¡€ç»„ä»¶ï¼ˆPostCardã€CommentListï¼‰

**Week 3: å‘å¸ƒä¸ä¿¡æ¯æµ**
- âœ… ä¸ªäººå¹¿æ’­å‘å¸ƒ
- âœ… ç¾¤/é¢‘é“åŒæ­¥å‘å¸ƒ
- âœ… æ¨èæµï¼ˆè§„åˆ™æ¨èï¼‰
- âœ… æœ€æ–°æµ

**Week 4: äº’åŠ¨ä¸æ²»ç†**
- âœ… ç‚¹èµ/æ”¶è—/è½¬å‘
- âœ… ä¸¾æŠ¥åŠŸèƒ½
- âœ… æ‹‰é»‘/å±è”½
- âœ… Context Tagï¼ˆæ¥æºæ ‡è¯†ï¼‰

**Week 5: æµ‹è¯•ä¸ä¼˜åŒ–**
- âœ… åŠŸèƒ½æµ‹è¯•
- âœ… æ€§èƒ½ä¼˜åŒ–
- âœ… å®‰å…¨æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- å¯ä»¥å‘å¸ƒä¸ªäººå¹¿æ’­
- å¯ä»¥åŒæ­¥ç¾¤/é¢‘é“å†…å®¹åˆ°å¹¿åœº
- æ¨èæµå’Œæœ€æ–°æµæ­£å¸¸å·¥ä½œ
- åŸºç¡€äº’åŠ¨åŠŸèƒ½å®Œæ•´
- æ²»ç†åŠŸèƒ½å¯ç”¨

---

### Phase 2: P1 ä½“éªŒå¢å¼ºï¼ˆ2-3 å‘¨ï¼‰

**Week 6: å†…å®¹æ§åˆ¶ä¸å‘ç°**
- âœ… ä¸æ„Ÿå…´è¶£åŠŸèƒ½
- âœ… æœ€æ–°/çƒ­é—¨åˆ‡æ¢
- âœ… å†…å®¹ç±»å‹ç­›é€‰

**Week 7: è¯„è®ºä¸å›æµ**
- âœ… è½»è¯„è®ºåŠŸèƒ½ï¼ˆå•å±‚ï¼Œæ— ç›–æ¥¼ï¼‰
- âœ… å¹¿åœºâ†”ç¾¤å›æµ
- âœ… ä¸ªäººé¡µ

**Week 8: ç®—æ³•ä¼˜åŒ–**
- âœ… è½»é‡å­¦ä¹ æ¨¡å‹ï¼ˆä»·å€¼é¢„æµ‹ã€å›æµé¢„æµ‹ã€é£é™©é¢„æµ‹ï¼‰
- âœ… å¤šç›®æ ‡åŠ æƒæ’åº

**éªŒæ”¶æ ‡å‡†**:
- ç”¨æˆ·å¯ä»¥æ§åˆ¶å†…å®¹åå¥½
- è¯„è®ºåŠŸèƒ½å®Œæ•´ä¸”å…‹åˆ¶
- å›æµåŠŸèƒ½æœ‰æ•ˆ
- ç®—æ³•æ¨èè´¨é‡æå‡

---

### Phase 3: P2 è§„æ¨¡åŒ–ï¼ˆæŒ‰éœ€ï¼‰

**åˆ›ä½œè€…å·¥å…·**:
- æ•°æ®é¢æ¿ï¼ˆæ›å…‰ã€äº’åŠ¨ã€å›æµç»Ÿè®¡ï¼‰
- ç½®é¡¶å¸–/ç³»åˆ—å¸–
- å†…å®¹ç®¡ç†

**é«˜çº§æ²»ç†**:
- ä¿¡èª‰åˆ†ç³»ç»Ÿ
- ååˆ·èµ/åæ¬è¿
- å†·å´æœºåˆ¶

**é«˜çº§å‘ç°**:
- ç›¸ä¼¼ç¾¤/é¢‘é“æ¨è
- æ–°å†…å®¹å†·å¯åŠ¨æ¢ç´¢æ± 
- å¤šè¯­è¨€/åœ°åŒºåŒ–æ¨è

---

## âœ… æ€»ç»“

### æ ¸å¿ƒåŸåˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰

1. **å¹¿åœº = å…¬å…±è¡¨è¾¾å±‚ï¼Œç¾¤/é¢‘é“ = ä¸»é¢˜ç©ºé—´ï¼Œç§èŠ = ç§å¯†å…³ç³»**
2. **å…¬å¼€ä¸ç§å¯†ä¸å†²çªï¼›å…¬å¼€å†…å®¹å¿…é¡»æ˜¯"ç”¨æˆ·ä¸»åŠ¨å…¬å¼€"**
3. **è¯„è®ºæ˜¯"å›åº”è¡¨è¾¾"ï¼Œä¸æ˜¯"äº‰å¤ºè¯è¯­æƒ"**
4. **ä¸åšæ›å…‰ç«æŠ€åœº - ä¸ä»¥ç²‰ä¸æ•°ä½œä¸ºä¸»è¦åˆ†å‘é€»è¾‘**
5. **æ²‰æ·€ä¼˜å…ˆ - æ ¸å¿ƒ KPI æ˜¯æ”¶è—ç‡ã€è½¬å‘ç‡ã€å›æµç‡**

### è¯„è®ºè®¾è®¡è¦ç‚¹

- âœ… å•å±‚è¯„è®ºï¼ˆä¸ç›–æ¥¼ï¼‰
- âœ… æ— çƒ­è¯„æ’åº
- âœ… å›åº”ä½œè€…ï¼Œä¸æ˜¯å†™ç»™è§‚ä¼—
- âœ… è¯„è®ºæ˜¯ç¼“å†²å±‚ï¼Œä¸æ˜¯ç»ˆç‚¹
- âœ… å¤šè½®å¯¹è¯ â†’ å¼•å¯¼å»ç¾¤é‡Œè®¨è®º

### æ¨èç®—æ³•è¦ç‚¹

**Phase 0 (P0)**:
- è§„åˆ™æ¨èï¼šå€™é€‰é›† + è¿‡æ»¤ + è¯„åˆ† + é€‰å–
- çº¿æ€§å¯è§£é‡Šï¼šæ”¶è—æƒé‡ > ç‚¹èµæƒé‡
- å›æµæƒé‡æœ€é«˜ï¼ˆä»…ç¾¤/é¢‘é“å†…å®¹ï¼‰
- å¼ºè´Ÿæƒé‡ï¼šä¸¾æŠ¥/æ‹‰é»‘/åƒåœ¾

**Phase 1 (P1)**:
- è½»é‡å­¦ä¹ ï¼šä»·å€¼é¢„æµ‹ + å›æµé¢„æµ‹ + é£é™©é¢„æµ‹
- å¤šç›®æ ‡åŠ æƒï¼šæ²‰æ·€ä¼˜å…ˆ
- ä¸æŠŠç²‰ä¸æ•°ä½œä¸ºæ ¸å¿ƒç‰¹å¾

**Phase 2 (P2)**:
- ä¸¤å¡”å¬å› + å¤æ‚æ’åºå™¨
- å‚è€ƒ X çš„å·¥ç¨‹æ€æƒ³ï¼Œä½†ä¿æŒç›®æ ‡å‡½æ•°

### X ç®—æ³•å‚è€ƒ

**ä»“åº“é“¾æ¥**: https://github.com/xai-org/x-algorithm

**å‚è€ƒå†…å®¹**:
- å€™é€‰æºæ‹†åˆ†ï¼ˆin-network / out-of-networkï¼‰
- Mixer/Pipeline åˆ†å±‚æ€æƒ³
- å¤šç›®æ ‡åŠ æƒæ–¹æ³•

**ä¸ç…§æ¬**:
- ä¸å¤åˆ»å…¶è®­ç»ƒ/Serving çš„é‡å·¥ç¨‹
- ä¿æŒ Echo çš„ç›®æ ‡å‡½æ•°ï¼šæ²‰æ·€ä¼˜å…ˆ
- é¿å…æ›å…‰ç«æŠ€åœº

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… å®Œæˆå¹¿åœºåŠŸèƒ½è®¾è®¡æ–‡æ¡£
2. ğŸ”„ æ›´æ–° IA æ–‡æ¡£ï¼Œæ·»åŠ å¹¿åœºç›¸å…³é¡µé¢
3. ğŸ”„ æ›´æ–° ECHO_ADMIN_PANEL.md ä¸­çš„ P2 å¹¿åœºåŠŸèƒ½
4. â³ å¼€å§‹ Phase 1 å¼€å‘ï¼ˆP0 æ ¸å¿ƒåŠŸèƒ½ï¼‰

---

**æœ€åæ›´æ–°**: 2026-01-28  
**çŠ¶æ€**: å¹¿åœºåŠŸèƒ½è®¾è®¡å®Œæˆï¼Œå¯ç›´æ¥ç”¨äºå¼€å‘

